@using KonciergeUi.Client.Shared
@using KonciergeUi.Client.State
@using KonciergeUI.Translations.Services
@inherits LayoutComponentBase

@inject UiState Ui;
@inject ILocalizationService L


<MudAppBar Elevation="1">
        <!-- Left: logo + name -->
        <MudIconButton Icon="@KonciergeIcons.Filled.Logo"
                       Color="Color.Secondary"
                       Edge="Edge.Start"
                       Class="mr-2" />
        <MudText Typo="Typo.h6" Class="mud-appbar-title">
            @L.Navigation["AppName"]
        </MudText>

        <!-- Center: navigation -->
        <MudSpacer />
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
            
            <MudButton StartIcon="@Icons.Material.Outlined.List" Href="/resources">@L.Navigation["NavResources"]</MudButton>
            <MudButton StartIcon="@Icons.Material.Outlined.Print" Href="/templates">@L.Navigation["NavTemplates"]</MudButton>
            <MudButton StartIcon="@Icons.Material.Outlined.NetworkPing" Href="/forwards">@L.Navigation["NavForwards"]</MudButton>
           
        </MudStack>
        <MudSpacer />

        <!-- Right: language selector + theme switch -->
        <MudIconButton Icon="@Icons.Material.Filled.Translate"
                       Color="Color.Inherit"
                       OnClick="ToggleLanguageMenu"
                       
                       @ref="_langButtonRef" />
        <MudMenu AnchorOrigin="Origin.BottomRight"
                 TransformOrigin="Origin.TopRight"
                 Open="@_langMenuOpen"
                 CloseMenuOnItemClick="true"
                 OnClose="() => _langMenuOpen = false"
                 ActivatorContent="@(builder => builder.AddContent(0, string.Empty))"
                 AnchorEl="@_langButtonRef">
            <MudMenuItem Icon="@KonciergeIcons.Flags.Uk"  OnClick="@(() => ChangeLanguage("en"))">English</MudMenuItem>
            <MudMenuItem Icon="@KonciergeIcons.Flags.Italy"  OnClick="@(() => ChangeLanguage("it"))">Italiano</MudMenuItem>
        </MudMenu>

        <MudIconButton Icon="@(_isDark ? Icons.Material.Filled.DarkMode : Icons.Material.Filled.LightMode)"
                       Color="Color.Inherit"
                       OnClick="@ToggleTheme" />
    </MudAppBar>

@code {
    private bool _langMenuOpen;
    private MudIconButton _langButtonRef = default!;

    [Parameter] 
    public bool _isDark { get; set; }

    [Parameter] 
    public EventCallback OnThemeChangedAsync { get; set; }

    protected override void OnInitialized()
    {
    }

    private async Task ToggleTheme()
    {
        _isDark = !_isDark;
       await OnThemeChangedAsync.InvokeAsync();
    }

    private void ToggleLanguageMenu()
    {
        _langMenuOpen = !_langMenuOpen;
    }

    private void ChangeLanguage(string culture)
    {
        L.SetCulture(culture);
        Ui.CurrentLanguage = culture;
        _langMenuOpen = false;
        StateHasChanged();
    }
}