@using KonciergeUI.Translations
@using KonciergeUI.Translations.Services
@using static KonciergeUI.Models.Forwarding.Enums
@inject ILocalizationService L;

<MudStack AlignItems="AlignItems.Center" Row>

    <MudIcon Color="@_statusColor" Icon="@_statusIcon" />
    <MudText Color="@_statusColor" Typo="Typo.body1">@_statusText</MudText>


</MudStack>

@code{
    [Parameter]
    public ForwardStatus _status { get; set; } = ForwardStatus.Stopped;

    private Color _statusColor = Color.Primary;
    private string _statusText = "";
    private string _statusIcon = Icons.Material.Outlined.CheckCircleOutline;


    protected override void OnInitialized()
    {
       
        refreshStatus();
        
        
        
        base.OnInitialized();
    }


    private string _lastHash = "";

    protected override bool ShouldRender()
    {
        var currentHash = _status.ToString();  // Your state checksum
    
        if (_lastHash != currentHash)
        {
            refreshStatus();

            return true;
        }
    
        Console.WriteLine("No state change - skipping render");
        return false;
    }

    private void refreshStatus()
    {
        _statusText = L.Enumerations[$"{TranslationPrefixes.EnumerationsPrefix.FORWARD_STATUS}.{_status.ToString().ToLower()}"];
        switch (_status)
        {

            case ForwardStatus.Starting:
                _statusColor = Color.Info;
                _statusIcon = Icons.Material.Outlined.HourglassBottom;
                break;
            case ForwardStatus.Running:
                _statusIcon = Icons.Material.Outlined.CheckCircleOutline;

                _statusColor = Color.Success;
                break;
            case ForwardStatus.Stopped:
                _statusColor = Color.Error;
                _statusIcon = Icons.Material.Outlined.StopCircle;

                break;
            case ForwardStatus.Reconnecting:
                _statusColor = Color.Warning;
                _statusIcon = Icons.Material.Outlined.Refresh;

                break;
            case ForwardStatus.Stopping:
                _statusColor = Color.Warning;
                _statusIcon = Icons.Material.Outlined.StopCircle;
                break;
            case ForwardStatus.Failed:
                _statusColor = Color.Error;
                _statusIcon = Icons.Material.Outlined.Error;
                break;
            default:
                _statusColor = Color.Transparent;
                _statusIcon = Icons.Material.Outlined.StopCircle;

                break;
        }
        _lastHash = _status.ToString();

       // StateHasChanged();

    }

}