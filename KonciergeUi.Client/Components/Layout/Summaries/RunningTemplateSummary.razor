@using KonciergeUi.Client.Components.Layout.Modals
@using KonciergeUi.Client.Extensions
@using KonciergeUI.Core.Abstractions
@using KonciergeUI.Data
@using KonciergeUI.Models.Forwarding
@inject IPreferencesStorage _storage
@inject IDialogService DialogService
@inject IPortForwardingService _fwdService



<MudCard>
    <MudCardHeader>
        <CardHeaderAvatar>
            <MudIcon Size="Size.Large" Icon="@KonciergeIcons.Outlined.ActiveForwards" Color="Color.Primary" />
        </CardHeaderAvatar>
        <CardHeaderContent>
        <MudStack AlignItems="AlignItems.Center" Row>
                <MudText Typo="Typo.body1">@_template.Definition.Name</MudText>
                <MudAlert Dense="true" Severity="Severity.Info">@_template.Forwards.Count Forward(s)</MudAlert>


                
            </MudStack>
            </CardHeaderContent>
        <CardHeaderActions>
                    <MudStack AlignItems="AlignItems.Center" Row>
                <MudText Typo="Typo.body2">Context: @($"{@_template.ClusterInfo.ContextName}@{@_template.ClusterInfo.Name}")</MudText>

            <MudButton OnClick="Stoptemplate" Color="Color.Error" StartIcon="@Icons.Material.Outlined.StopCircle">Stop Template</MudButton>
            </MudStack>
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent>
        @foreach (var fwd in _template.Forwards)
        {
            <RunningForwardSummary _cluster="_template.ClusterInfo" _instance="fwd" />
        }
    </MudCardContent>
    <MudCardActions>
      
    </MudCardActions>
</MudCard>


@code {


    [Parameter]
    public RunningTemplate _template { get; set; }

    

    private async Task Stoptemplate(MouseEventArgs arg)
    {
    
        
                await DialogService.ShowConfirmationActionAsync(() => _fwdService.StopTemplateAsync(_template.TemplateId));

    }

}